# Задание по созданию ASP.NET Core API (Подробное описание)

## 1. Общая идея проекта
Цель – создать **ASP.NET Core API**, реализующее базовый функционал онлайн-площадки для продажи товаров. В проекте должны быть следующие ключевые элементы:

1. Набор **сущностей** (Product, Category, Order, User), с возможностью расширения по мере необходимости.
2. Полноценные **CRUD-операции** для сущностей.
3. Реализованная **функция платного продвижения** продуктов (Топ/Премиум) и **автоматическая отмена** этого статуса по истечении времени с помощью фоновой задачи.
4. **Логирование** всех действий (включая админские и действия фоновой задачи).
5. **Роли** и **разграничение доступа** (Admin, User).
6. Возможность **отправки e-mail-уведомлений** при изменении статуса продукта фоновой задачей (доп. задание).
7. Соблюдение **Repository паттерна** и **принципов SOLID**.

## 2. Сущности

1. **Пользователь (User)**:
   - Минимальный набор полей:
     - `Id` (уникальный идентификатор)
     - `UserName` (логин или имя пользователя)
     - `Email`
     - `PasswordHash` (храним в зашифрованном виде)
     - `Role` (Admin или User или возможно создать отдельнюю таблицу) 
   - Дополнительные поля по необходимости.

2. **Категория (Category)**:
   - `Id`
   - `Name` (название категории)
   - `Description` (по желанию)

3. **Продукт (Product)**:
   - `Id`
   - `Name` (название продукта)
   - `Description`
   - `Price`
   - `CategoryId` (ссылка на категорию)
   - `UserId` (кто добавил продукт)
   - `IsTop` (булево поле: в Топе или нет)
   - `IsPremium` (булево поле: Премиум-статус или нет)
   - `PremiumOrTopExpiryDate` (дата и время, когда статус Топ/Премиум должен истечь)
   - Дополнительные поля по необходимости (изображения, количество и т.д.).

4. **Заказ (Order)** (Опционально, базовые поля для понимания):
   - `Id`
   - `UserId` (кто сделал заказ)
   - `ProductId`
   - `Quantity` (количество товара)
   - `OrderDate` (дата заказа)
   - `Status` (например, “Оформлен”, “В пути”, “Доставлен”)

## 3. CRUD-операции

### 3.1 Общие требования для CRUD
- Реализовать стандартные методы для всех сущностей:
  - **Create** (POST)
  - **Read** (GET)
  - **Update** (PUT/PATCH)
  - **Delete** (DELETE)
### 3.2 Учёт прав доступа
- **User** может видеть и редактировать **только свои** продукты (привязанные к его `UserId`).
- **Admin** может выполнять любые операции (создавать, изменять, удалять продукты, пользователей, заказы и т.д.).

## 4. Репозиторий (Repository) и принципы SOLID
- При работе с базой данных нужно создать **репозитории** для каждой сущности.
- Репозиторий должен содержать методы типа:
  - `GetAll()`, `GetById(id)`, `Add(entity)`, `Update(entity)`, `Delete(entity)` и т.п.
- Внутри репозиториев нельзя напрямую «размывать» бизнес-логику; придерживайтесь принципа **Single Responsibility**.
- Постарайтесь минимизировать дублирование кода (DRY) и соблюдать **Open-Closed** и остальные принципы **SOLID**.

## 5. Функциональность платного размещения

1. **Оплата** за продвижение продукта:
   - Предположим, что пользователь может оплатить услугу, благодаря которой его продукт становится **Топ** или **Премиум** (можно разделить на 2 разных статуса).
   - При успешной оплате в `Product` проставляются флаги `IsTop = true` или `IsPremium = true` (или оба) и устанавливается `PremiumOrTopExpiryDate` (например, текущая дата + 7 дней).

2. **Проверка истечения срока**:
   - Необходимо реализовать **Background Task** (фоновую службу), которая периодически (например, каждые 24 часа или раз в час) проверяет, у каких продуктов истёк `PremiumOrTopExpiryDate`.
   - Если текущее время > `PremiumOrTopExpiryDate`, то нужно убрать соответствующие статусы у продукта:
     - `IsTop = false`
     - `IsPremium = false`
   - Важно, чтобы эта проверка не была привязана к вызовам контроллеров – она должна работать **автономно** (через `BackgroundService` или Hangfire).

## 6. Логирование действий

   - Нужно вести журнал (лог) **всех действий** в приложении:
     - **CRUD-операции** продуктов, категорий, заказов и пользователей.
     - **Действия фоновой задачи** (когда статус продукта изменился с Топ/Премиум на обычный).
     - **Действия, доступные только админам** (например, удаление пользователей, изменение чужих продуктов и т.д.).
## 7. Роли и разграничение доступа

1. **Роли**:
   - **Admin** – имеет полный доступ к системе:
     - Может создавать, редактировать и удалять всех пользователей, продукты, заказы и т.д.
     - Имеет доступ к логам (может просматривать и анализировать).
   - **User** – имеет ограниченные права:
     - Может создавать, редактировать, удалять **только свои** продукты.
     - Может просматривать категории, продукты, заказы и собственные данные.
     - Не имеет доступа к редактированию чужих продуктов или чужих заказов.

2. **Способы разграничения**:
   - Использовать **JWT**-аутентификацию.

## 8. Расширенное задание (e-mail уведомления)

Для тех, кто хочет дополнительную задачу:

**Отправка e-mail**:
   - Когда фоновая задача снимает статус Топ/Премиум с продукта (т.е. `IsTop = false` и/или `IsPremium = false`), **отправить уведомление** владельцу продукта на его e-mail.
   - Текст письма: «Ваш продукт [Название] больше не находится в Топе / Премиум. Срок размещения истёк.»